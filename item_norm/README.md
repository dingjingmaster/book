## 书名及作者名归一化流程整理

#### 目标

- 为了将内容相同的书籍合并为一组（区分开来）
- 可以把这组书的阅读量等用户行为映射在一起，用来衡量这本书的好坏
- 展示的时候，一组书中只展示最好的那一本，其它不再展示
- 新付费书入库后没有行为，当有映射关系的时候，可以直接将行为映射上去

#### 存在的问题

1. 规则归一化的局限性
    1. 严重依赖原始的书名、作者名，当有些书是错误的书名或作者名时，产生错误的结果
    2. 规则难找，一份规则用于几百万的数据时，对某一规则的修改，可能影响其他本来处理正确的数据，因此规则一定是普遍的，而特殊的只能用白名单做特别处理
    3. 对于新进的书籍，旧的规则可能产生不好的影响，也有可能不起作用。因此要时常更新规则
    
2. 相似度归一的局限性
    1. 依赖章节信息，如果章节信息中只有 “第一章” 这样的信息，那么则没法使用
    2. 每本书章节数量太大，需要取部分章节处理，我取前20章，同时要提取这前20章的关键字。也要尽可能减少章节比较次数
    3. 章节中存在一些无用的信息，这些信息不属于书籍内容，类似作者 求月票之类的，针对这些信息要尽可能去除干净
    
3. 规则归一结果与相似度归一结果合并的问题
    1. 规则中有错误可能会在合并之后导致整组都出现错误

#### 1. 规则归一化流程

- 从数据库拉取：gid、付费状态、历史累计订阅量、原始书名、原始作者名
- 根据正则处理 书名和作者名，其中一些特殊情况要用到白名单作直接替换

#### 2. 相似度归一化流程

- 在规则归一的基础上，预估书名和作者名的相似度，把相似度低的数据直接过滤出去，保留相似度高的数据做下一步处理
- 针对上一步的结果进行进一步的章节相似度计算，如果章节相似度够高，则认为可以归一到一组

#### 3. 规则归一结果 和 相似度归一结果合并

- 规则归一之后，以归一化的 书名和作者名 为key，聚合一组的 gid
- 相似度归一后，以章节相似度大的结果来聚合一组的 gid，考虑到书名和作者名选择，采用以下策略：
    1. 有付费书的组，取付费书累计订阅量最大的那本书的 归一化结果 为本组书的归一化结果
    2. 没有付费书的组，取累计订阅量最大的那本书的 归一化结果 为本组书的归一化结果
- 合并相似度 和 归一化结果，先取规则结果 与 相似度结果 的并集，以下几种合并办法：
    1. 哪组 gid 占 并集gid 比例大，选择哪组gid的归一化结果作为并集归一化的结果；优先选相似度的结果
    2. 直接取并集，最后选择结果中订阅量最大的付费书归一结果为本组归一结果，没有付费书的选择免费书订阅量最大的归一结果为本组归一结果